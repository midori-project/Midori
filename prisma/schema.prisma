generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                 String                  @id @default(uuid())
  email              String?                 @unique
  displayName        String?
  avatarUrl          String?
  locale             String?                 @default("th")
  isActive           Boolean                 @default(true)
  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @updatedAt
  lastLoginAt        DateTime?
  agents             Agent[]
  authCredentials    AuthCredential[]
  emailVerifications AuthEmailVerification[]
  passwordResets     AuthPasswordReset[]
  runs               ChatRun[]
  commands           Command[]
  conversations      Conversation[]
  generations        Generation[]
  loginLogs          LoginAttempt[]
  messages           Message[]
  oauths             OAuthConnection[]
  projects           Project[]
  likes              ProjectLike[]
  sessions           Session[]

  @@index([email])
}

model Project {
  id               String             @id @default(uuid())
  ownerId          String
  name             String
  description      String?
  visibility       Visibility         @default(private)
  options          Json               @default("{}")
  likeCount        Int                @default(0)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  deletedAt        DateTime?
  previewFileId    String?            @unique
  tenantId         String?
  templateTheme    Json?
  previewEnabled   Boolean            @default(true)
  previewAutoBuild Boolean            @default(true)
  previewSettings  Json?
  agents           Agent[]
  Artifact         Artifact[]
  runs             ChatRun[]
  commands         Command[]
  conversations    Conversation[]
  copyBlocks       CopyBlock[]
  deployments      Deployment[]
  files            File[]
  generations      Generation[]
  imageAssets      ImageAsset[]
  imageBriefs      ImageBrief[]
  plans            OrchestratorPlan[]
  patchSets        PatchSet[]
  previews         PreviewSession[]
  owner            User               @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  previewFile      File?              @relation("ProjectPreviewFile", fields: [previewFileId], references: [id])
  tenant           Tenant?            @relation(fields: [tenantId], references: [id])
  categories       ProjectCategory[]
  projectContext   ProjectContext?
  likes            ProjectLike[]
  snapshots        Snapshot[]
  specBundles      SpecBundle[]
  testRuns         TestRun[]
  testSuites       TestSuite[]

  @@index([ownerId])
  @@index([tenantId])
}

model File {
  id                 String              @id @default(uuid())
  projectId          String
  path               String
  type               FileType            @default(code)
  isBinary           Boolean             @default(false)
  content            String?
  blob               Bytes?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  project            Project             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  imageAssets        ImageAsset[]
  messageAttachments MessageAttachment[]
  previewForProject  Project?            @relation("ProjectPreviewFile")
  artifacts          TestArtifact[]

  @@unique([projectId, path])
  @@index([projectId])
}

model Snapshot {
  id               String           @id @default(uuid())
  projectId        String
  label            String?
  files            Json
  fromGenerationId String?
  createdAt        DateTime         @default(now())
  templateData     Json?
  Artifact         Artifact[]
  patchSetsFrom    PatchSet[]       @relation("PatchSetFrom")
  patchSetsTo      PatchSet[]       @relation("PatchSetTo")
  previews         PreviewSession[]
  fromGeneration   Generation?      @relation(fields: [fromGenerationId], references: [id])
  project          Project          @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
}

model Deployment {
  id        String         @id @default(uuid())
  projectId String
  provider  DeployProvider
  state     DeployState    @default(queued)
  url       String?
  meta      Json?
  createdAt DateTime       @default(now())
  project   Project        @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
}

model PreviewSession {
  id            String       @id @default(uuid())
  projectId     String
  snapshotId    String?
  url           String?
  state         PreviewState @default(queued)
  meta          Json?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  expiresAt     DateTime?
  accessedAt    DateTime?
  buildTimeMs   Int?
  errorMessage  String?
  authToken     String?
  authExpiresAt DateTime?
  project       Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)
  snapshot      Snapshot?    @relation(fields: [snapshotId], references: [id])

  @@index([projectId])
  @@index([snapshotId])
  @@index([state])
  @@index([expiresAt])
}

model AuthCredential {
  id             String                  @id @default(uuid())
  userId         String
  type           String
  identifier     String
  secret         String?
  metadata       Json?
  isVerified     Boolean                 @default(false)
  expiresAt      DateTime?
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
  user           User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  emailVerifs    AuthEmailVerification[]
  passwordResets AuthPasswordReset[]

  @@unique([userId, type, identifier])
  @@index([userId])
  @@index([identifier])
}

model AuthEmailVerification {
  id           String          @id @default(uuid())
  userId       String
  credentialId String?
  tokenHash    String
  expiresAt    DateTime
  usedAt       DateTime?
  createdAt    DateTime        @default(now())
  credential   AuthCredential? @relation(fields: [credentialId], references: [id])
  user         User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
}

model AuthPasswordReset {
  id           String          @id @default(uuid())
  userId       String
  credentialId String?
  tokenHash    String
  expiresAt    DateTime
  usedAt       DateTime?
  createdAt    DateTime        @default(now())
  credential   AuthCredential? @relation(fields: [credentialId], references: [id])
  user         User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
}

model OAuthConnection {
  id                    String        @id @default(uuid())
  userId                String
  provider              OAuthProvider
  providerAccountId     String
  accessTokenEncrypted  String?
  refreshTokenEncrypted String?
  scope                 String?
  expiresAt             DateTime?
  createdAt             DateTime      @default(now())
  user                  User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id               String    @id @default(uuid())
  userId           String
  sessionTokenHash String    @unique
  ip               String?
  userAgent        String?
  createdAt        DateTime  @default(now())
  expiresAt        DateTime
  lastActiveAt     DateTime? @default(now())
  terminatedAt     DateTime?
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
}

model LoginAttempt {
  id         String        @id @default(uuid())
  userId     String?
  loginEmail String?
  provider   LoginProvider
  ip         String?
  success    Boolean
  createdAt  DateTime      @default(now())
  user       User?         @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([createdAt])
}

model Agent {
  id             String         @id @default(uuid())
  projectId      String?
  userId         String?
  name           String
  description    String?
  kind           AgentKind      @default(chat)
  model          String
  systemPrompt   String?
  tools          Json?
  config         Json?
  temperature    Float?         @default(0.7)
  topP           Float?         @default(1)
  isActive       Boolean        @default(true)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  project        Project?       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user           User?          @relation(fields: [userId], references: [id])
  runs           ChatRun[]
  sourceCommands Command[]
  conversations  Conversation[]

  @@index([projectId])
  @@index([userId])
}

model Conversation {
  id         String     @id @default(uuid())
  projectId  String?
  userId     String?
  agentId    String?
  title      String?
  visibility Visibility @default(private)
  context    Json?
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  archivedAt DateTime?
  runs       ChatRun[]
  commands   Command[]
  agent      Agent?     @relation(fields: [agentId], references: [id])
  project    Project?   @relation(fields: [projectId], references: [id])
  user       User?      @relation(fields: [userId], references: [id])
  messages   Message[]

  @@index([projectId])
  @@index([userId])
  @@index([agentId])
}

model Message {
  id             String              @id @default(uuid())
  conversationId String
  userId         String?
  role           ChatRole
  content        String?
  contentJson    Json?
  runId          String?
  toolName       String?
  toolInput      Json?
  toolOutput     Json?
  messageIndex   Int
  createdAt      DateTime            @default(now())
  conversation   Conversation        @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  run            ChatRun?            @relation(fields: [runId], references: [id])
  user           User?               @relation(fields: [userId], references: [id])
  attachments    MessageAttachment[]

  @@index([conversationId, messageIndex])
  @@index([userId])
  @@index([runId])
}

model MessageAttachment {
  id        String   @id @default(uuid())
  messageId String
  fileId    String?
  url       String?
  kind      String?
  meta      Json?
  createdAt DateTime @default(now())
  file      File?    @relation(fields: [fileId], references: [id])
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([messageId])
  @@index([fileId])
}

model ChatRun {
  id               String       @id @default(uuid())
  conversationId   String
  userId           String?
  projectId        String?
  agentId          String?
  model            String
  tokensInput      Int          @default(0)
  tokensOutput     Int          @default(0)
  costUsd          Decimal      @default(0)
  latencyMs        Int?
  status           String?
  error            String?
  rawRequest       Json?
  rawResponse      Json?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  agent            Agent?       @relation(fields: [agentId], references: [id])
  conversation     Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  project          Project?     @relation(fields: [projectId], references: [id])
  user             User?        @relation(fields: [userId], references: [id])
  messages         Message[]
  createdPatchSets PatchSet[]

  @@index([conversationId])
  @@index([agentId])
  @@index([userId])
  @@index([projectId])
}

model Command {
  id             String             @id @default(uuid())
  projectId      String?
  userId         String?
  conversationId String?
  sourceAgentId  String?
  target         String?
  commandType    String
  commandJson    Json
  status         CommandStatus      @default(queued)
  error          String?
  createdAt      DateTime           @default(now())
  startedAt      DateTime?
  finishedAt     DateTime?
  conversation   Conversation?      @relation(fields: [conversationId], references: [id])
  project        Project?           @relation(fields: [projectId], references: [id])
  sourceAgent    Agent?             @relation(fields: [sourceAgentId], references: [id])
  user           User?              @relation(fields: [userId], references: [id])
  events         CommandEvent[]
  plans          OrchestratorPlan[]

  @@index([projectId])
  @@index([userId])
  @@index([conversationId])
}

model CommandEvent {
  id        String   @id @default(uuid())
  commandId String
  kind      String
  data      Json?
  createdAt DateTime @default(now())
  command   Command  @relation(fields: [commandId], references: [id], onDelete: Cascade)

  @@index([commandId])
}

model OrchestratorPlan {
  id        String             @id @default(uuid())
  projectId String
  commandId String?
  title     String?
  decision  Json?
  createdAt DateTime           @default(now())
  edges     OrchestratorEdge[]
  command   Command?           @relation(fields: [commandId], references: [id])
  project   Project            @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tasks     OrchestratorTask[]

  @@index([projectId])
  @@index([commandId])
}

model OrchestratorTask {
  id         String           @id @default(uuid())
  planId     String
  taskKey    String
  to         String
  action     String
  payload    Json?
  status     TaskStatus       @default(pending)
  error      String?
  startedAt  DateTime?
  finishedAt DateTime?
  createdAt  DateTime         @default(now())
  plan       OrchestratorPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@unique([planId, taskKey])
  @@index([planId])
}

model OrchestratorEdge {
  id         String           @id @default(uuid())
  planId     String
  fromTaskId String
  toTaskId   String
  plan       OrchestratorPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@index([planId])
}

model SpecBundle {
  id        String        @id @default(uuid())
  projectId String
  label     String?
  version   Int           @default(1)
  data      Json
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  project   Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  versions  SpecVersion[]

  @@index([projectId])
}

model SpecVersion {
  id        String     @id @default(uuid())
  bundleId  String
  version   Int
  diff      Json?
  snapshot  Json
  createdAt DateTime   @default(now())
  bundle    SpecBundle @relation(fields: [bundleId], references: [id], onDelete: Cascade)

  @@unique([bundleId, version])
  @@index([bundleId])
}

model ProjectContext {
  id                  String        @id @default(uuid())
  projectId           String        @unique
  specBundleId        String
  projectType         ProjectType
  status              ProjectStatus @default(created)
  components          Json
  pages               Json
  styling             Json
  conversationHistory Json
  userPreferences     Json
  lastModified        DateTime      @default(now())
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  preview             Json?
  frontendV2Data      Json?
  project             Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([specBundleId])
}

model UiTemplate {
  id                String              @id @default(uuid())
  key               String              @unique
  label             String
  category          String?
  createdAt         DateTime            @default(now())
  demoData          Json?
  jsonSource        Json?
  placeholderConfig Json?
  previewUrl        String?
  themeMapping      Json?
  meta              UiTemplateMeta?
  versions          UiTemplateVersion[]
}

model UiTemplateVersion {
  id              String                 @id @default(uuid())
  templateId      String
  version         Int
  files           Json?
  slots           Json?
  constraints     Json?
  createdAt       DateTime               @default(now())
  checksum        String?
  compat          Json?
  deprecatedAt    DateTime?
  publishedAt     DateTime?
  semver          String?
  sizeBytes       Int?
  status          TemplateStatus         @default(published)
  aiGenerated     Json?
  demoPreview     Json?
  fillHistory     Json?
  placeholderData Json?
  sourceFiles     TemplateSourceFile[]   @relation("Version_SourceFiles")
  sourceSummary   TemplateSourceSummary? @relation("Version_SourceSummary")
  template        UiTemplate             @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@unique([templateId, version])
  @@index([templateId])
  @@index([status])
  @@index([createdAt])
}

model UiTemplateMeta {
  id                String              @id @default(uuid())
  templateId        String              @unique
  description       String?
  engine            String?
  status            TemplateStatus?     @default(draft)
  versioningPolicy  String?
  previewScreenshot String?
  compat            Json?
  postProcess       Json?
  author            String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  template          UiTemplate          @relation(fields: [templateId], references: [id], onDelete: Cascade)
  tags              UiTemplateMetaTag[]

  @@index([engine])
  @@index([status])
  @@index([createdAt])
}

model Tag {
  id        String              @id @default(uuid())
  key       String              @unique
  label     String
  createdAt DateTime            @default(now())
  metaLinks UiTemplateMetaTag[]
}

model UiTemplateMetaTag {
  id        String         @id @default(uuid())
  metaId    String
  tagId     String
  createdAt DateTime       @default(now())
  meta      UiTemplateMeta @relation(fields: [metaId], references: [id], onDelete: Cascade)
  tag       Tag            @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([metaId, tagId])
  @@index([metaId])
  @@index([tagId])
}

model TemplateSourceFile {
  id          String            @id @default(uuid())
  versionId   String
  path        String
  type        String?
  content     String
  encoding    String
  contentType String?
  size        Int
  sha256      String
  createdAt   DateTime          @default(now())
  version     UiTemplateVersion @relation("Version_SourceFiles", fields: [versionId], references: [id], onDelete: Cascade)

  @@unique([versionId, path])
  @@index([versionId])
  @@index([sha256])
}

model TemplateSourceSummary {
  id         String            @id @default(uuid())
  versionId  String            @unique
  filesCount Int
  sizeBytes  Int
  checksum   String
  createdAt  DateTime          @default(now())
  version    UiTemplateVersion @relation("Version_SourceSummary", fields: [versionId], references: [id], onDelete: Cascade)
}

model CopyBlock {
  id          String   @id @default(uuid())
  projectId   String
  key         String
  locale      String   @default("th")
  content     String?
  contentJson Json?
  version     Int      @default(1)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, key, locale, version])
  @@index([projectId])
}

model ImageBrief {
  id              String       @id @default(uuid())
  projectId       String
  sourceMessageId String?
  prompt          String?
  promptJson      Json?
  styleHints      Json?
  createdAt       DateTime     @default(now())
  assets          ImageAsset[]
  project         Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
}

model ImageAsset {
  id        String      @id @default(uuid())
  projectId String
  briefId   String?
  fileId    String?
  provider  String?
  meta      Json?
  createdAt DateTime    @default(now())
  brief     ImageBrief? @relation(fields: [briefId], references: [id])
  file      File?       @relation(fields: [fileId], references: [id])
  project   Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([briefId])
  @@index([fileId])
}

model PatchSet {
  id             String    @id @default(uuid())
  projectId      String
  fromSnapshotId String?
  toSnapshotId   String?
  createdByRunId String?
  meta           Json?
  createdAt      DateTime  @default(now())
  patches        Patch[]
  createdByRun   ChatRun?  @relation(fields: [createdByRunId], references: [id])
  fromSnapshot   Snapshot? @relation("PatchSetFrom", fields: [fromSnapshotId], references: [id])
  project        Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  toSnapshot     Snapshot? @relation("PatchSetTo", fields: [toSnapshotId], references: [id])

  @@index([projectId])
  @@index([createdByRunId])
}

model Patch {
  id         String               @id @default(uuid())
  patchSetId String
  filePath   String
  changeType GenerationChangeType @default(update)
  hunks      Json?
  createdAt  DateTime             @default(now())
  patchSet   PatchSet             @relation(fields: [patchSetId], references: [id], onDelete: Cascade)

  @@unique([patchSetId, filePath])
  @@index([patchSetId])
  @@index([filePath])
}

model TestSuite {
  id        String     @id @default(uuid())
  projectId String
  name      String
  kind      String
  meta      Json?
  createdAt DateTime   @default(now())
  cases     TestCase[]
  runs      TestRun[]
  project   Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
}

model TestCase {
  id         String    @id @default(uuid())
  suiteId    String
  name       String
  definition Json?
  createdAt  DateTime  @default(now())
  suite      TestSuite @relation(fields: [suiteId], references: [id], onDelete: Cascade)
  runs       TestRun[]

  @@index([suiteId])
}

model TestRun {
  id                String         @id @default(uuid())
  projectId         String
  suiteId           String?
  caseId            String?
  triggeredByTaskId String?
  status            TestStatus     @default(queued)
  stats             Json?
  startedAt         DateTime?
  finishedAt        DateTime?
  createdAt         DateTime       @default(now())
  artifacts         TestArtifact[]
  case              TestCase?      @relation(fields: [caseId], references: [id])
  project           Project        @relation(fields: [projectId], references: [id], onDelete: Cascade)
  suite             TestSuite?     @relation(fields: [suiteId], references: [id])

  @@index([projectId])
  @@index([suiteId])
  @@index([caseId])
}

model TestArtifact {
  id        String   @id @default(uuid())
  runId     String
  kind      String
  url       String?
  fileId    String?
  meta      Json?
  createdAt DateTime @default(now())
  file      File?    @relation(fields: [fileId], references: [id])
  run       TestRun  @relation(fields: [runId], references: [id], onDelete: Cascade)

  @@index([runId])
  @@index([fileId])
}

model Generation {
  id           String           @id @default(uuid())
  projectId    String
  userId       String
  prompt       Json?
  promptJson   Json?
  options      Json             @default("{}")
  model        String
  tokensInput  Int              @default(0)
  tokensOutput Int              @default(0)
  costUsd      Decimal          @default(0)
  createdAt    DateTime         @default(now())
  project      Project          @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user         User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  changes      GenerationFile[]
  snapshots    Snapshot[]

  @@index([projectId])
  @@index([userId])
}

model GenerationFile {
  id           String               @id @default(uuid())
  generationId String
  filePath     String
  fileContent  String?
  changeType   GenerationChangeType @default(create)
  generation   Generation           @relation(fields: [generationId], references: [id], onDelete: Cascade)

  @@index([generationId])
}

model Category {
  id        String            @id @default(uuid())
  key       String            @unique
  label     String
  meta      Json?
  createdAt DateTime          @default(now())
  projects  ProjectCategory[]
}

model ProjectCategory {
  id         String   @id @default(uuid())
  projectId  String
  categoryId String
  order      Int?
  createdAt  DateTime @default(now())
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, categoryId])
  @@index([projectId])
  @@index([categoryId])
}

model ProjectLike {
  id        String   @id @default(uuid())
  projectId String
  userId    String
  createdAt DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId])
  @@index([projectId])
  @@index([userId])
}

model Tenant {
  id        String    @id @default(uuid())
  key       String    @unique
  name      String?
  createdAt DateTime  @default(now())
  projects  Project[]
}

model Artifact {
  id                String          @id @default(cuid())
  projectId         String
  snapshotId        String?
  specBundleVersion Int?
  createdAt         DateTime        @default(now())
  buildFramework    String
  buildEngine       String?
  buildNode         String
  buildCli          String?
  buildHash         String
  buildRunner       String?
  buildDurationMs   Int?
  storageProvider   String?
  storageBucket     String?
  storagePrefix     String?
  storageRegion     String?
  gateStatus        GateStatus?
  failingGates      Json?
  coverage          Decimal?        @db.Decimal(3, 2)
  testSummary       String?
  previewEnabled    Boolean         @default(false)
  previewTtl        Int?
  previewToken      String?
  previewUrl        String?
  deployProvider    DeployProvider?
  deployState       DeployState?
  deployUrl         String?
  deployCacheKey    String?
  deployMeta        Json?
  manifestHash      String?
  signature         String?
  signedBy          String?
  project           Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  snapshot          Snapshot?       @relation(fields: [snapshotId], references: [id])
  files             ArtifactFile[]
  links             ArtifactLink[]

  @@index([projectId, createdAt])
  @@index([snapshotId])
  @@index([deployState, createdAt])
  @@index([gateStatus, createdAt])
}

model ArtifactFile {
  id                String    @id @default(cuid())
  artifactId        String
  path              String
  mimeType          String
  hash              String
  size              Int?
  cacheTtl          Int?
  cacheImmutable    Boolean?
  cacheHeaders      Json?
  content           String?
  externalUrl       String?
  externalSigned    Boolean?
  externalExpiresAt DateTime?
  artifact          Artifact  @relation(fields: [artifactId], references: [id], onDelete: Cascade)

  @@unique([artifactId, path])
  @@index([hash])
}

model ArtifactLink {
  id         String   @id @default(cuid())
  artifactId String
  kind       String
  url        String?
  filePath   String?
  meta       Json?
  createdAt  DateTime @default(now())
  artifact   Artifact @relation(fields: [artifactId], references: [id], onDelete: Cascade)

  @@index([artifactId, kind])
}

enum Visibility {
  private
  unlisted
  public
}

enum FileType {
  code
  text
  config
  asset
}

enum OAuthProvider {
  github
  google
  line
  custom_oauth
}

enum LoginProvider {
  credentials
  github
  google
  line
  custom_oauth
}

enum DeployProvider {
  vercel
  github_pages
  netlify
}

enum DeployState {
  queued
  building
  ready
  failed
}

enum GenerationChangeType {
  create
  update
  delete
}

enum ChatRole {
  user
  assistant
  system
  tool
}

enum AgentKind {
  chat
  orchestrator
  blueprint
  copywriter
  visual
  editor
  squasher
  tester
  debugger
}

enum CommandStatus {
  queued
  running
  completed
  failed
  cancelled
}

enum TaskStatus {
  pending
  running
  success
  failed
  cancelled
}

enum TestStatus {
  queued
  running
  passed
  failed
  skipped
  errored
}

enum GateStatus {
  pass
  fail
}

enum ProjectType {
  coffee_shop
  restaurant
  e_commerce
  portfolio
  blog
  landing_page
  business
  personal
  healthcare
  hotel
}

enum ProjectStatus {
  created
  in_progress
  completed
  paused
  cancelled
  template_selected
}

enum ComponentType {
  header
  hero
  menu
  card
  footer
  content
  sidebar
  navigation
  button
  form
  modal
  gallery
  testimonial
  pricing
  contact
  about
  services
  products
  blog
  custom
}

enum PageType {
  home
  about
  contact
  menu
  products
  services
  blog
  gallery
  custom
}

enum TemplateStatus {
  draft
  published
  deprecated
}

enum PreviewState {
  queued
  building
  ready
  failed
  expired
  cancelled
}
