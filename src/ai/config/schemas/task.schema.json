{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://midori.dev/schemas/task.schema.json",
  "title": "Task Schema",
  "description": "Schema สำหรับ orchestrator tasks",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique task identifier"
    },
    "planId": {
      "type": "string",
      "description": "Parent plan identifier"
    },
    "action": {
      "type": "string",
      "enum": [
        "spec.store_upsert",
        "editor.create_component",
        "editor.modify_component",
        "copywriter.generate_content",
        "visual.create_image",
        "squasher.merge_patches",
        "testing.run",
        "preview.build",
        "deploy.publish"
      ],
      "description": "Action to perform"
    },
    "agent": {
      "type": "string",
      "enum": ["blueprint", "editor", "copywriter", "visual", "squasher", "tester", "debug"],
      "description": "Agent responsible for this task"
    },
    "input": {
      "type": "object",
      "description": "Input data for the task"
    },
    "output": {
      "type": "object",
      "description": "Output data from the task"
    },
    "dependencies": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Task IDs that must complete before this task"
    },
    "status": {
      "type": "string",
      "enum": ["pending", "running", "completed", "failed", "cancelled"],
      "default": "pending",
      "description": "Current task status"
    },
    "priority": {
      "type": "number",
      "minimum": 1,
      "maximum": 10,
      "default": 5,
      "description": "Task priority (1=lowest, 10=highest)"
    },
    "retryCount": {
      "type": "number",
      "minimum": 0,
      "default": 0,
      "description": "Number of retry attempts"
    },
    "maxRetries": {
      "type": "number",
      "minimum": 0,
      "default": 3,
      "description": "Maximum retry attempts allowed"
    },
    "timeout": {
      "type": "number",
      "minimum": 0,
      "description": "Task timeout in milliseconds"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "createdAt": { "type": "string", "format": "date-time" },
        "startedAt": { "type": "string", "format": "date-time" },
        "completedAt": { "type": "string", "format": "date-time" },
        "duration": { "type": "number" },
        "error": { "type": "string" },
        "logs": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "timestamp": { "type": "string", "format": "date-time" },
              "level": {
                "type": "string",
                "enum": ["debug", "info", "warn", "error"]
              },
              "message": { "type": "string" }
            }
          }
        }
      }
    }
  },
  "required": ["id", "planId", "action", "agent"]
}
