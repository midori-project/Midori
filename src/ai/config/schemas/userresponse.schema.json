{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://midori.dev/schemas/userresponse.schema.json",
  "title": "User Response Schema",
  "description": "Schema สำหรับ user responses และ collected data",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique response identifier"
    },
    "sessionId": {
      "type": "string",
      "description": "Question session identifier"
    },
    "questionId": {
      "type": "string",
      "description": "Question identifier"
    },
    "userId": {
      "type": "string",
      "description": "User identifier"
    },
    "projectId": {
      "type": "string",
      "description": "Associated project identifier"
    },
    "response": {
      "oneOf": [
        { "type": "string" },
        { "type": "number" },
        { "type": "boolean" },
        { "type": "array" },
        { "type": "object" }
      ],
      "description": "User's response value"
    },
    "confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "User's confidence in their answer (0-1)"
    },
    "source": {
      "type": "string",
      "enum": ["manual", "smart_default", "inferred", "imported"],
      "description": "How the response was obtained"
    },
    "validation": {
      "type": "object",
      "properties": {
        "isValid": { "type": "boolean" },
        "errors": {
          "type": "array",
          "items": { "type": "string" }
        },
        "warnings": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "description": "Response validation results"
    },
    "timing": {
      "type": "object",
      "properties": {
        "startedAt": { "type": "string", "format": "date-time" },
        "answeredAt": { "type": "string", "format": "date-time" },
        "duration": { "type": "number" },
        "revisited": { "type": "number" }
      },
      "description": "Response timing information"
    },
    "context": {
      "type": "object",
      "properties": {
        "previousAnswers": { "type": "object" },
        "userAgent": { "type": "string" },
        "device": { "type": "string" },
        "referrer": { "type": "string" }
      },
      "description": "Context when response was given"
    },
    "feedback": {
      "type": "object",
      "properties": {
        "clarity": {
          "type": "number",
          "minimum": 1,
          "maximum": 5
        },
        "relevance": {
          "type": "number",
          "minimum": 1,
          "maximum": 5
        },
        "comments": { "type": "string" }
      },
      "description": "User feedback about the question"
    },
    "derived": {
      "type": "object",
      "properties": {
        "implications": {
          "type": "array",
          "items": { "type": "string" }
        },
        "recommendations": {
          "type": "array",
          "items": { "type": "string" }
        },
        "relatedQuestions": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "description": "AI-derived insights from the response"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "version": { "type": "string" },
        "locale": { "type": "string" },
        "ip": { "type": "string" },
        "sessionData": { "type": "object" }
      }
    }
  },
  "required": ["id", "sessionId", "questionId", "response"]
}
